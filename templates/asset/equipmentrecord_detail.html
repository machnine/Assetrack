{% extends "base.html" %}
{% load markdown_filters %}
{% block page_title %}
  Equipment record - {{ record.equipment }}
{% endblock page_title %}
{% block content %}
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span><i class="bi bi-card-checklist"></i> Equipment record - <a href="{% url 'equipment_detail' record.equipment.id %}">{{ record.equipment }}</a></span>
      <span>
        <a href="{% url 'equipmentrecord_update' record.id %}?next={{ request.path }}" title="Edit"><i class="bi bi-pencil-square"></i></a>
        <a href="{% url 'equipmentrecord_delete' record.id %}" title="Delete"><i class="bi bi-trash"></i></a>
        <a hx-get="{% url 'equipmentrecord_attachment_upload' record.id %}"
           hx-trigger="click"
           hx-target="#modal-box .modal-content"
           hx-swap="innerHTML"
           data-bs-toggle="modal"
           data-bs-target="#modal-box"
           title="Upload a file"
           href="javascript:"><i class="bi bi-file-earmark-arrow-up"></i></a>
      </span>
    </div>
    <div class="card-body">
      <div class="row pb-1">
        <div class="col-6 col-lg-3 mb-1">
          <span class="field-label d-block">Date</span>
          <span class="field-value">{{ record.date|date:"d/m/Y" }}</span>
        </div>
        <div class="col-6 col-lg-3 mb-1">
          <span class="field-label d-block">Record type</span>
          <span class="field-value" style="color: {{ record.record_type.color }};">{{ record.record_type }}</span>
        </div>
        <div class="col-6 col-lg-3 mb-1">
          <span class="field-label d-block">Created</span>
          <span class="field-value">{{ record.created_at|date:"d/m/Y H:i" }} <span class="text-muted">{{ record.created_by.initials|default:"" }}</span></span>
        </div>
        <div class="col-6 col-lg-3 mb-1">
          <span class="field-label d-block">Updated</span>
          <span class="field-value">{{ record.last_updated|date:"d/m/Y H:i" }} <span class="text-muted">{{ record.last_updated_by.initials|default:"" }}</span></span>
        </div>
      </div>
      <div class="row pt-1 pb-1">
        <div class="col-12 mb-1">
          <span class="field-label d-block">Description</span>
          <span class="field-value">{{ record.description|md_link }}</span>
        </div>
      </div>
      <div class="row pt-1">
        <div class="col-12">
          {% if attachments|length %}
            <span class="field-label d-block">Attachments</span>
            <div class="row">
              {% for file in attachments %}
                <div class="col-12 d-flex justify-content-between align-items-center data-row">
                  <span>
                    {% if file.filetype %}
                      <i class="bi bi-filetype-{{ file.filetype }} text-info"></i>
                    {% else %}
                      <i class="bi bi-file-earmark text-info"></i>
                    {% endif %}
                    <a href="{{ file.file.url }}" title="{{ file.description }}">{{ file.name }} - {{ file.file.size|filesizeformat }}</a>
                  </span>
                  <span>
                    <a hx-get="{% url 'equipmentrecord_attachment_update' file.id %}"
                       hx-trigger="click"
                       hx-target="#modal-box .modal-content"
                       hx-swap="innerHTML"
                       data-bs-toggle="modal"
                       data-bs-target="#modal-box"
                       href="javascript:"><i class="bi bi-pencil-square"></i></a>
                    <a hx-get="{% url 'equipmentrecord_attachment_delete' file.id %}"
                       hx-trigger="click"
                       hx-target="#modal-box .modal-content"
                       hx-swap="innerHTML"
                       data-bs-toggle="modal"
                       data-bs-target="#modal-box"
                       href="javascript:"><i class="bi bi-trash"></i></a>
                  </span>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock content %}
{% block modals %}
  <div class="modal fade" id="modal-box" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <!-- HTMX rendered content -->
      </div>
    </div>
  </div>
{% endblock modals %}
